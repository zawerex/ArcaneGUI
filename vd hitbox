return (function()
    local Players = game:GetService("Players")
    local RunService = game:GetService("RunService")
    
    local LocalPlayer = Players.LocalPlayer
    
    local function GetRole()
        if not LocalPlayer.Team then return "Survivor" end
        local teamName = LocalPlayer.Team.Name:lower()
        if teamName:find("killer") then 
            return "Killer" 
        end
        return "Survivor"
    end
    
    local function IsSurvivor(targetPlayer)
        if not targetPlayer or not targetPlayer.Team then return false end
        local teamName = targetPlayer.Team.Name:lower()
        return teamName:find("survivor") or teamName == "survivors" or teamName == "survivor"
    end
    
    local enabled = false
    local hitboxSize = 20
    local connection = nil
    local OriginalHitboxSizes = {}
    
    local function UpdateHitboxes()
        if GetRole() ~= "Killer" then
            -- Восстановить оригинальные размеры
            for player, originalSize in pairs(OriginalHitboxSizes) do
                if player and player.Character then
                    local root = player.Character:FindFirstChild("HumanoidRootPart")
                    if root then
                        root.Size = originalSize
                        root.Transparency = 1
                        root.CanCollide = true
                    end
                end
            end
            OriginalHitboxSizes = {}
            return
        end
        
        if not enabled then
            -- Восстановить оригинальные размеры
            for player, originalSize in pairs(OriginalHitboxSizes) do
                if player and player.Character then
                    local root = player.Character:FindFirstChild("HumanoidRootPart")
                    if root then
                        root.Size = originalSize
                        root.Transparency = 1
                        root.CanCollide = true
                    end
                end
            end
            OriginalHitboxSizes = {}
            return
        end
        
        -- Обновить хитовоксы
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and IsSurvivor(player) then
                local char = player.Character
                if char then
                    local root = char:FindFirstChild("HumanoidRootPart")
                    local hum = char:FindFirstChildOfClass("Humanoid")
                    
                    if root and hum and hum.Health > 0 then
                        -- Сохранить оригинальный размер
                        if not OriginalHitboxSizes[player] then
                            OriginalHitboxSizes[player] = root.Size
                        end
                        
                        -- Установить новый размер
                        local size = hitboxSize
                        root.Size = Vector3.new(size, size, size)
                        root.CanCollide = false
                        root.Transparency = 0.7
                    elseif root then
                        -- Восстановить оригинальный размер
                        if OriginalHitboxSizes[player] then
                            root.Size = OriginalHitboxSizes[player]
                            root.Transparency = 1
                            root.CanCollide = true
                            OriginalHitboxSizes[player] = nil
                        end
                    end
                end
            end
        end
    end
    
    local function Enable()
        if enabled then return end
        enabled = true
        print("Hitbox Enabled")
        
        if connection then
            connection:Disconnect()
        end
        
        connection = RunService.Heartbeat:Connect(function()
            UpdateHitboxes()
        end)
    end
    
    local function Disable()
        if not enabled then return end
        enabled = false
        
        if connection then
            connection:Disconnect()
            connection = nil
        end
        
        -- Восстановить оригинальные размеры
        for player, originalSize in pairs(OriginalHitboxSizes) do
            if player and player.Character then
                local root = player.Character:FindFirstChild("HumanoidRootPart")
                if root then
                    root.Size = originalSize
                    root.Transparency = 1
                    root.CanCollide = true
                end
            end
        end
        OriginalHitboxSizes = {}
        
        print("Hitbox Disabled")
    end
    
    local function SetSize(size)
        hitboxSize = tonumber(size) or 20
        print("Hitbox size set to: " .. hitboxSize)
    end
    
    return {
        Enable = Enable,
        Disable = Disable,
        SetSize = SetSize,
        IsEnabled = function() return enabled end,
        GetSize = function() return hitboxSize end
    }
end)()
